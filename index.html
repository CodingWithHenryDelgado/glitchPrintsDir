<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glitch Prints!</title>
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="./reset.css" />
    <meta property="og:title" content="Glitch Prints - Get your 3D models printed" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://glitchprints.com/" />
    <title>Make your creations into reality</title>
    <meta name="description"
        content="Do you have a 3D model you want to print? I can help with that. Let's make this creation into reality!" />
    <meta property="og:image" content="" />
    <meta property="og:site_name" content="Glitch Prints - Get your 3D models printed" />
    <meta property="og:description"
        content="Do you have a 3D model you want to print? I can help with that. Let's make this creation into reality!" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Baloo+Thambi+2&family=Metrophobic&family=Roboto+Mono:ital@0;1&display=swap"
        rel="stylesheet">
    <script type="importmap">
            {
                "imports": {
                    "three": "https://unpkg.com/three@0.138.0/build/three.module.js",
                    "OrbitControls": "https://unpkg.com/three@0.138.0/examples/jsm/controls/OrbitControls.js"
                }
            }
        </script>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Glitch Prints</h1>
        </div>
        <div class="nav">
            <a href="#about">About Me</a>
            <a href="#portfolio">Portfolio</a>
            <a href="#contact">Contact Me</a>
        </div>
        <div id="quote">
            <div class="statContainer">
                <div class="insertmodel">
                    <h2>Drop Your Model</h2>
                    <div class="dragdrop">
                        <!-- ### <START> STL file manager ### -->
                        <div class="dropSTL"
                            style="overflow:hidden; border:0; margin:0; width:calc(100%); position:absolute;">
                            <input type="file" value="internal file" id="fileselect"
                                onchange="load_local_file(this.files[0]);" style="opacity:0;">
                            <iframe id="vs_iframe" src="https://www.viewstl.com/?embedded"
                                style="border:0;margin:0;width:100%;height:100%;"></iframe>
                        </div>

                        <button id="reset" onclick="refreshIframe('viewstl')" style="height:42px;">Reset
                            STL</button>

                        <div class="scalediv" style="height:42px;">

                            <a class="b1" style="width:45px; left:0px; top:0px;">Scale:</a>
                            <input id="scale" oninput="update_axis()" value="100" min="0" type="number" step="5"
                                style="z-index:1; text-align:right; background-color:#e3f7e7;height:14px; position:absolute; left:45px; top:0px;">
                            <a class="b1" style="width:20px; left:100px; top:0px;">%
                                <div class="line1" style="width:2px; top:0px; left:100%;"></div>
                            </a>

                            <div class="b1" style="width:32px; right:0px;"><output id="unit_svol"></output>
                                <output id="shape_vol"
                                    style="overflow:hidden; text-align:right; padding-right:2px; background-color:#e3f7e7; width:44px; height:100%; position:absolute; top:0px; right:100%;"></output>
                                <div class="b1" style="font-size:12px; width:40px; top:0px; right:calc(100% + 46px);">
                                    Vol.:</div> <a style="font-size:14px; z-index:1; height:20px; right:2px;">cm 3</a>
                            </div>

                            <a class="b1" style="left:0px; top:21px;">x:
                                <output id="x" class="axis"></output></a>

                            <a class="b1" style="left:33.3%; top:21px">y:
                                <output id="y" class="axis"></output></a>

                            <a class="b1" style="left:66.7%; top:21px">z:
                                <output id="z" class="axis"></output></a>

                        </div>

                        <div class="stat_box">
                            <div class="stat_value">
                                <input id="unit" name="unit" type="radio" value="0" onclick="update_unit()"
                                    checked="checked">MM
                                <input id="unit" name="unit" type="radio" value="1" onclick="update_unit()">IN
                            </div>
                            <div class="bvol">
                                Box vol:
                                <output id="box_vol" style="background-color:#e3f7e7;"></output><a
                                    style="font-size:14px; z-index:1; height:20px; right:2px;">cm 3</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <script type="module" src="./script.js"></script>
    <script>
        const vstl = document.getElementById("vs_iframe"); //view_stl object
        const input = document.getElementById("fileselect");
        const x = document.getElementById("x");
        const y = document.getElementById("y");
        const z = document.getElementById("z");
        const svol = document.getElementById("shape_vol");
        const bvol = document.getElementById("box_vol");

        var unit_1, unit_2, mult_1, mult_2, fixed;

        function load_local_file(f) { vstl.contentWindow.postMessage({ msg_type: 'load', file: f }, '*'); }

        // STL file viewer - function handler
        vstl.onload = function () {

            vstl.contentWindow.postMessage({ msg_type: "get_info" }, "*");
            window.onmessage = function (e) {
                if (e.origin == "https://www.viewstl.com" && e.data.msg_type) {
                    if (e.data.msg_type == "info") {
                        input.style.display = "none";
                        input_size = false;
                        x_axis = e.data.x;
                        y_axis = e.data.y;
                        z_axis = e.data.z;
                        shape_volume = e.data.volume / 1000;

                        update_unit();
                    }
                }
            }
        }

        function refreshIframe(name) {
            document.getElementById('vs_iframe').contentWindow.postMessage({ msg_type: 'clean' }, '*');
            var ifr = document.getElementsByName(name)[0];
            input_size = true;
            x_axis = 0;
            y_axis = 0;
            z_axis = 0;
            shape_vol = 0;
            area = 0;
            input.style.display = "block";
        }

        function update_unit() {
            var unit;
            var radios = document.getElementsByName('unit');
            for (var i = 0, length = radios.length; i < length; i++) {
                if (radios[i].checked) {
                    unit = radios[i].value;
                    break;
                }
            }
            var mult_0;
            if (unit == 0) {
                unit_1 = "mm"; unit_2 = "cm"; fixed = 0;
                mult_0 = 25.4; mult_1 = 1; mult_2 = 1;
            } else { //unit == 1
                unit_1 = "in"; fixed = 1;
                mult_0 = 1 / 25.4; mult_1 = 1 / 25.4; mult_2 = Math.pow(1 / 25.4, 3) / Math.pow(1 / 10, 3);
            }
            update_axis();
            update_vol();
        }

        function update_axis() {
            var scale = document.getElementById('scale').value / 100;
            if (input_size == true) {
                x_axis = document.getElementById('x_input').value / mult_1;
                y_axis = document.getElementById('y_input').value / mult_1;
                z_axis = document.getElementById('z_input').value / mult_1;
            }

            if (x_axis + y_axis + z_axis != 0) {
                //1. Round off to 0.1mm if below 1000mm, else round off to 1mm
                //2. Prevent absurd numbers

                if (scale * x_axis * mult_1 < 1000) {
                    x.value = Math.abs(scale * x_axis * mult_1).toFixed(1 + fixed);
                } else if (scale * x_axis < 10000) {
                    x.value = Math.abs(scale * x_axis * mult_1).toFixed(0 + fixed);
                } else { x.value = "Huge"; }

                if (scale * y_axis * mult_1 < 1000) {
                    y.value = Math.abs(scale * y_axis * mult_1).toFixed(1 + fixed);
                } else if (scale * y_axis < 10000) {
                    y.value = Math.abs(scale * y_axis * mult_1).toFixed(0 + fixed);
                } else { y.value = "Huge"; }

                if (scale * z_axis * mult_1 < 1000) {
                    z.value = Math.abs(scale * z_axis * mult_1).toFixed(1 + fixed);
                } else if (scale * z_axis < 10000) {
                    z.value = Math.abs(scale * z_axis * mult_1).toFixed(0 + fixed);
                } else { z.value = "Huge"; }
            }
            else {
                x.value = "";
                y.value = "";
                z.value = "";
                bvol.value = "";
            }

            update_vol();
        }

        function update_vol() {
            var scale = document.getElementById('scale').value / 100;

            box_vol = x_axis * y_axis * z_axis * Math.pow(scale, 3) / 1000;

            if (box_vol != 0) {
                if (box_vol < 10000000) {
                    bvol.value = (box_vol * mult_2).toFixed(0 + fixed);
                } else {
                    bvol.value = "Too big!";
                }
            } else {
                bvol.value = "";
            }

            if (shape_volume != 0) {
                if (shape_volume * Math.pow(scale, 3) < 1000000) {
                    svol.value = (shape_volume * Math.pow(scale, 3) * mult_2).toFixed(0 + fixed);
                } else {
                    svol.innerHTML = "<a style='font-size:12px;'>Too big!</a>";
                    //svol.innerHTML = "Too big!";
                }
            } else {
                svol.value = "";
            }

            // update_price();
        }
    </script>
</body>

</html>